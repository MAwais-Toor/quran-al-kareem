<!DOCTYPE html>
<html lang="en" class="bg-gradient-to-b from-white to-slate-100 text-gray-900">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Surah</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Amiri&family=Noto+Nastaliq+Urdu&display=swap');

    .font-arabic {
      font-family: 'Amiri', serif;
    }

    .font-urdu {
      font-family: 'Noto Nastaliq Urdu', serif;
      direction: rtl;
    }
  </style>
</head>

<body class="min-h-screen">

  <!-- Header -->
  <header class="sticky top-0 bg-white/80 backdrop-blur shadow z-10 p-4">
    <a href="index.html" class="text-blue-600 hover:underline">← Back to Surah List</a>
    <h1 id="surah-name" class="text-2xl font-bold mt-2 text-emerald-700"></h1>
    <p id="surah-info" class="text-sm text-gray-600"></p>
  </header>

  <!-- Ayahs -->
  <main class="p-6 max-w-4xl mx-auto mt-4 space-y-6">
    <div id="ayahs" class="space-y-6"></div>
  </main>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const surahNumber = urlParams.get("id");

    let ayahAudioList = [];
    let currentAyahIndex = -1;
    let audioPlayer = new Audio();
    let playing = false;

    fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}/editions/ar.alafasy,ur.jalandhry`)
      .then(res => res.json())
      .then(resData => {
        const [arabicData, urduData] = resData.data;

        document.getElementById("surah-name").textContent = `${arabicData.englishName} - ${arabicData.name}`;
        document.getElementById("surah-info").textContent = `Verses: ${arabicData.numberOfAyahs} | Revelation: ${arabicData.revelationType}`;

        const container = document.getElementById("ayahs");

        for (let i = 0; i < arabicData.ayahs.length; i++) {
          const arabic = arabicData.ayahs[i];
          const urdu = urduData.ayahs[i];
          ayahAudioList.push(arabic.audio);

          const div = document.createElement("div");
          div.className = "bg-white/80 p-5 rounded-xl border border-gray-200 shadow transition-all";

          div.innerHTML = `
            <div class="flex justify-between items-start gap-4" id="ayah-${i}">
              <div class="text-right w-full">
                <div class="font-arabic text-2xl text-gray-900 mb-2">
                  ${arabic.text} <span class="text-xl text-gray-500">۝</span>
                </div>
                <div class="font-urdu text-xl text-emerald-700 leading-loose">${urdu.text}</div>
                <div class="text-sm text-gray-400 mt-2">(${arabic.numberInSurah})</div>
              </div>
              <button id="btn-${i}" onclick="toggleAudio(${i})" class="p-2 text-emerald-600 hover:text-emerald-800" title="Play Audio">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-6 h-6">
                  <path d="M3 22v-20l18 10-18 10z" />
                </svg>
              </button>
            </div>
          `;
          container.appendChild(div);
        }

        // Auto play next Ayah
        audioPlayer.addEventListener("ended", () => {
          if (currentAyahIndex !== -1) {
            document.getElementById(`ayah-${currentAyahIndex}`)?.classList.remove("bg-yellow-100", "ring-2", "ring-yellow-400");
            updateButtonIcon(currentAyahIndex, "play");
          }
          currentAyahIndex++;
          if (currentAyahIndex < ayahAudioList.length) {
            playFromIndex(currentAyahIndex);
          }
        });
      });

    function toggleAudio(index) {
      if (currentAyahIndex === index) {
        if (playing) {
          audioPlayer.pause();
          playing = false;
          updateButtonIcon(index, "play");
        } else {
          audioPlayer.play();
          playing = true;
          updateButtonIcon(index, "pause");
        }
      } else {
        if (currentAyahIndex !== -1) {
          document.getElementById(`ayah-${currentAyahIndex}`)?.classList.remove("bg-yellow-100", "ring-2", "ring-yellow-400");
          updateButtonIcon(currentAyahIndex, "play");
        }
        playFromIndex(index);
      }
    }

    function playFromIndex(index) {
      currentAyahIndex = index;
      audioPlayer.pause();
      audioPlayer.src = ayahAudioList[index];
      audioPlayer.play();
      playing = true;

      document.getElementById(`ayah-${index}`)?.classList.add("bg-yellow-100", "ring-2", "ring-yellow-400");
      updateButtonIcon(index, "pause");
    }

    function updateButtonIcon(index, type) {
      const btn = document.getElementById(`btn-${index}`);
      if (!btn) return;

      btn.innerHTML = type === "pause" ? `
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
          <path d="M6 4h4v16H6zm8 0h4v16h-4z" />
        </svg>
      ` : `
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
          <path d="M3 22v-20l18 10-18 10z" />
        </svg>
      `;
    }
  </script>

</body>

</html>
